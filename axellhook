-- // Load Orion UI Lib
local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()

-- // Config
local Config = {
    WebhookURL = "",
    NotifyEnabled = true,
    FilterRarity = {"Mythic", "Secret"}, -- default kirim Mythic & Secret
    RoleID = "1401925291223420939"
}

-- // Rare Fish Database
local RareFish = {
    Mythic = {
        "Manta Ray",
        "Hammerhead Shark",
        "Dotted Stingray",
        "Loggerhead Turtle",
        "Prismy Seahorse",
        "Blueflame Ray",
        "Magma Shark",
        "Hawks Turtle",
        "Abyss Seahorse",
        "Thresher Shark",
        "Strippled Seahorse",
        "Hermit Crab",
        "Plasma Shark"
    },
    Secret = {
        "Blob Shark",
        "Ghost Shark",
        "Worm Fish",
        "Crystal Crab",
        "Orca",
        "Megalodon",
        "Lochness Monster",
        "Monster Shark",
        "Eerie Shark",
        "Thin Armor Shark",
        "Scare",
        "Great Whale",
        "Frostborn Shark"
    }
}

local EmbedColors = {
    Mythic = 0xFF0000, -- merah
    Secret = 0x3EB489  -- hijau mint
}

-- // Cek kategori ikan
local function getFishCategory(fishName)
    for _, v in ipairs(RareFish.Mythic) do
        if v:lower() == fishName:lower() then return "Mythic" end
    end
    for _, v in ipairs(RareFish.Secret) do
        if v:lower() == fishName:lower() then return "Secret" end
    end
    return nil
end

-- // Kirim Webhook
local function sendWebhook(playerName, fishName, category, island, weight)
    if not Config.NotifyEnabled or Config.WebhookURL == "" then return end
    if not table.find(Config.FilterRarity, category) then return end

    local mention = "<@&" .. Config.RoleID .. ">"
    local data = {
        ["username"] = "Fish It! Notifier",
        ["content"] = mention, -- Mention Role
        ["embeds"] = {{
            ["title"] = "üé£ Rare Catch!",
            ["description"] = playerName .. " just caught a **" .. fishName .. "**",
            ["color"] = EmbedColors[category] or 0xFFFFFF,
            ["fields"] = {
                {["name"] = "Category", ["value"] = category, ["inline"] = true},
                {["name"] = "Island", ["value"] = island or "Unknown", ["inline"] = true},
                {["name"] = "Weight", ["value"] = tostring(weight or "??") .. " kg", ["inline"] = true},
            },
            ["footer"] = {["text"] = "Fish It! Auto Notifier"}
        }}
    }

    local request = request or http_request or (syn and syn.request)
    if request then
        request({
            Url = Config.WebhookURL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = game:GetService("HttpService"):JSONEncode(data)
        })
    end
end

-- // Event Tangkap Ikan
local fishEvent = game.ReplicatedStorage:WaitForChild("FishCaught")
fishEvent.OnClientEvent:Connect(function(fishName, rarity, island, weight)
    local category = getFishCategory(fishName)
    if category then
        sendWebhook(game.Players.LocalPlayer.Name, fishName, category, island, weight)
    end
end)

-- // UI Orion
local Window = OrionLib:MakeWindow({Name = "üêü Fish It! Webhook Notifier", HidePremium = false, SaveConfig = false})

local Tab = Window:MakeTab({
    Name = "Webhook",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Input Webhook
Tab:AddTextbox({
    Name = "Webhook URL",
    Default = "",
    TextDisappear = false,
    Callback = function(value)
        Config.WebhookURL = value
    end
})

-- Toggle Enable
Tab:AddToggle({
    Name = "Enable Webhook Notifications",
    Default = true,
    Callback = function(state)
        Config.NotifyEnabled = state
    end
})

-- Dropdown Filter
Tab:AddDropdown({
    Name = "Filter by Rarity",
    Default = {"Mythic", "Secret"},
    Options = {"Mythic", "Secret"},
    Multiple = true,
    Callback = function(selected)
        Config.FilterRarity = selected
    end
})

-- Test Button
Tab:AddButton({
    Name = "Test Webhook",
    Callback = function()
        sendWebhook(game.Players.LocalPlayer.Name, "Test Fish", "Mythic", "Test Island", 99.9)
    end
})

OrionLib:Init()
